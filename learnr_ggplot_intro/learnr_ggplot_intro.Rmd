---
title: "Visualize data with ggplot"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(ggplot2)
knitr::opts_chunk$set(echo = FALSE)

mtcars <- mtcars
mtcars$name <- rownames(mtcars)

```


# Visualizing data with ggplot2

## Introduction

In this interactive tutorial, you will learn the basics of visualizing data with ggplot2. ggplot2 is one of the various packages for R, and the most widely used package for graphs. It is also a part of the tidyverse.

Let's jump right into it! Below you see a graph that has been created with ggplot2 and which shows data from the (in-)famous [mtcars-dataset](https://stat.ethz.ch/R-manual/R-patched/library/datasets/html/mtcars.html). The mtcars dataset contains information about 10 different automobile models (their weight, miles per gallon,...) from a 1974 issue of the US Motor Trends magazine. This dataset is not particular interesting as such but it comes pre-cleaned with R so we'll use it for this demonstration.

```{r intrograph, exercise=F}

ggplot(data = mtcars, aes(x=wt,y=mpg)) +
    geom_point() +
    ylab("Miles per gallon") +
    xlab("Weight ('000 lbs)")

```

This graph is a so-called *scatterplot*. Each of the black dots is a single observation in the dataset (a car model) and they are arranged according to their weight (the horizontal or x-axis) and miles-per-gallon fuel efficiency (the vertical or y-axis). Scatterplots are ideal when we want to show how two *metric* (a.k.a. continuous, linear) variables are related to each other. This graph shows that heavier cars are less fuel-efficient, i.e. can drive fewer miles for each gallon of fuel (not very surprising).

So how was this graph created? Below you see the code behind the graph:
```{r eval=F,echo=T}
ggplot(data = mtcars, aes(x=wt,y=mpg)) +
    geom_point() +
    ylab("Miles per gallon") +
    xlab("Weight ('000 lbs)")
```

You can probably already see what is going on here (and that this isn't rocket science!). The first line starts with the main `ggplot()` function --- in essence, we tell R that we want to make a graph with ggplot. Inside the parentheses, we specify the most important information (or 'arguments', in the R-lingo) we need for the graph: a) what dataset we want to use; b) which variables from that dataset we want to use; and c) where the variables should go. 

With `data = mtcars`, we tell R that we want to use the mtcars-dataset. The next part, after the comma, specifies the main dimensions (or 'aesthetics') of the graph: `aes(x=wt,y=mpg)`. You can see directly that we use this to tell R which variables we want to use and which should go on the x- and the y-axis. The two variables we want to use are the weight-variable (saved as `wt` in the dataset) and the miles-per-gallon (`mpg`) variable. And we want the weight-variable on the x-axis and miles-per-gallon on the y-axis.

### Re-create the graph yourself

Now over to you! Below you see the code we just described --- run it and see what happens!

```{r bare, exercise = T}
ggplot(data = mtcars, aes(x=wt,y=mpg))
```

Great, now we have a graph --- but the *content* is lacking (disappointing, I know...). This shows you an important logic of ggplot: The first step is to define the main aspects of the graph --- the dataset, the variables and their locations. Once we have this, we add the content. In ggplot, the content --- the dots in a scatterplot, the bars in a bar graph, the lines in a line graph --- are referred to as 'geometric objects' or 'geoms'. This may sound a bit overly complicated but makes sense --- a dot or a line is a geometric object! 

We add these geometric objects as a second 'layer' to the graph we just created as shown below. Go ahead, run the code!
```{r geoms, exercise=T}
ggplot(data = mtcars, aes(x=wt,y=mpg)) +
    geom_point()
```

Notice the little `+` symbol at the end of the first line? This plus-symbol tells R to take the code goes before it to make the first layer of a graph, and add (`+`) the code on the following line to it as a second layer. *The plus-symbol is important in ggplot!* We use it to add extra layers to our graphs.

You also see that we now added our 'geoms' to the graph --- now we have our dots! In ggplot, we add dots via `geom_point()` (dot - point, tomayto - tomahto). For other types of graphs, we use other 'geoms', for instance:

* `geom_line()` for lines
* `geom_bar()` for bars
* `geom_text()` for little pieces of text
* ... (see the [ggplot-website](https://ggplot2.tidyverse.org/reference/) for an overview)

OK --- we have a bare-bones statistical graph! Now let's pretty it up a bit by adding more informative titles to the axes. Can you add titles for the x- and y-axis by using code from above (also, don't copy and paste --- you'll learn more that way)

```{r titles, exercise=T}
ggplot(data = mtcars, aes(x=wt,y=mpg)) +
    geom_point()
```

### Change one of the variables

Happy with your graph? Now let's go a step further: Change one of the variables in the graph. Included in the mtcars-dataset is also the variable horsepower (`hp`), which as the name suggests measures the horsepower of the different car models --- how strong their engines are. Let's see how the horsepower of a car's engine is related to its fuel efficiency.

Take the code below and:

* Take out the `wt` variable and put in the `hp` variable instead
* Adapt the title of the x-axis accordingly

```{r prob1, exercise=T}
ggplot(data = mtcars, aes(x=wt,y=mpg)) +
    geom_point() +
    ylab("Miles per gallon") +
    xlab("Weight ('000 lbs)")
```

### Adding a third variable: Different sizes for the dots

So far, the main dimensions or aesthetics of our graphs that we have defined are the two axes. We have placed one variable on the x-axis and one on the y-axis. But sometimes we want to add a third variable to some some more complicated relationships. One way of doing this is to change the sizes of the points according to the values of another variable. 

We can do this by adding a third main dimension --- or 'aesthetic' --- to our graph. In our case, we want our points to change in size depending on a different variable. Let's take the number of cylinders in the cars' engine. Run the code below! 

```{r aes1, exercise = T}
ggplot(data = mtcars, aes(x=wt,y=mpg)) +
    geom_point(aes(size=cyl)) +
    ylab("Miles per gallon") +
    xlab("Weight ('000 lbs)")
```

You see that most of the code is the same as above, but we have now added another aesthetic (`aes()`) to the `geom_point()` layer: We tell R that the size (`size`) of each of the points should depend on the `cyl` variable in the dataset (the number of cylinders). 

*Important* We could also have added the size-aesthetic to the main `ggplot()` command like so:
```{r aes2, exercise = T}
ggplot(data = mtcars, aes(x=wt,y=mpg,size=cyl)) +
    geom_point() +
    ylab("Miles per gallon") +
    xlab("Weight ('000 lbs)")
```

If you run the code, you see that the result is the same. But it does make sense to add it to the `geom_point()` layer below because this makes it clearer what is going on here. Our code gets easier to read, which is a good thing!

Note also that ggplot automatically adds a legend on the right! Altogether, we can see now that heavier cars not only have a worse fuel efficiency, but they also tend to have larger engines with more cylinders. Makes sense, doesn't it?

### Using labels instead of dots

The graph as it is looks quite neat, but all we see now is a number of dots. It would surely be nicer if we could see what models of cars we're looking at here. Remember that one of the different 'geoms' was called `geom_text()`? We can use this to show us the name of the car model. The logic is the same as adding another variable to graph, which we did above. In essence, we add the name of the model as a variable to the graph. 

I've prepared some code that does just this. Run the code first and let's then talk about what is going on here.

```{r names1, exercise=T}
ggplot(data = mtcars, aes(x=wt,y=mpg)) +
    geom_text(aes(label = name)) +
    ylab("Miles per gallon") +
    xlab("Weight ('000 lbs)")
```

You notice that most of the code is still the same as it was before: We create the base layer of the graph with the `ggplot()` function and then add different layers to it via the `+` symbol and the code that follows.

You also see that the `geom_point()` command is now replaced by `geom_text()`. Obviously, `geom_text` tells R that we want a piece of text here --- this isn't too difficult, is it? But now there is again code to specify some aesthetics (`aes()`) of the graph --- what is going on here? 

With `geom_text()`, we tell R that we want some text added to the graph. But then we also need to tell R which *particular* piece of text it should use. In our case, we want the graph to show the names of car models, which are saved in the `name` variable in our dataset. We tell R that we want to label our individual data points with the contents of the `name` variable with `label = name`. And then we have to designate this as another aesthetic (`aes()`). This is similar to above, where we let the points vary in size --- only here we let the name vary between the different observations.

All clear (more or less)? Well, great job! You just learned how to create a basic statistical graph in ggplot! Continue on to the next lesson to learn how to do this entirely by yourself.

## Doing it yourself

### Prep work - Loading packages and data

If you were doing all this by yourself, the first step would be to load the ggplot2 package. Remember: R itself only offers some basic functionality and we use packages for 
more advanced things (or, often, to make our lives a bit easier...). Packages such as ggplot2 need to be installed and loaded. Below you see the code to install the ggplot2 package from the internet, fully automatically:

```{r eval=F,echo=T}
install.packages("ggplot2")
```

If you like, you can run this code in RStudio on your computer later. For now, we have installed the package and will now load it so that we can use it:
```{r eval=F,echo=T}
library(ggplot2)
```

The library-function is used to load packages. The prep-work is almost done - now we only have to load the dataset:
```{r eval=F,echo=T}
mtcars <- mtcars
```
As mentioned, the mtcars dataset comes with R, so this is easy. Remember the arrow --- the 'assignment operator' --- from the lecture? Here we use it to take the mtcars-dataset that is stored somewhere deep in the R program files and 'assign' it to the object 'mtcars'.
